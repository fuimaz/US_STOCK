# 缠论实时交易系统 - 快速入门

## 🚀 5分钟快速上手

### 步骤1: 运行批量回测（验证策略有效性）

```bash
python backtest_all_cached_stocks_10y.py
```

**预期输出**:
```
====================================================================================================
批量回测缓存中所有股票 - 缠论实时方案（近10年）
====================================================================================================
发现 117 只有缓存数据的股票

[1/117] Processing: 000001.SZ
  [OK] Strategy: 104.2% | Buy&Hold: 30.8% | Excess: +73.4% | WinRate: 45.7%
...

Overall Statistics:
  Strategy Return:
    Average: 1378.01%
    Best: 39957.62% (TSLA)
  Excess Return:
    Average: +1131.03%
    Positive: 104/112 (92.9%)
```

**说明**: 策略在10年回测中平均收益1378%，大幅跑赢买入持有

---

### 步骤2: 运行演示脚本（熟悉输出格式）

```bash
python scan_signals_demo.py
```

**预期输出**:
```
====================================================================================================
Chan Theory Real-time Signal Scan - DEMO
====================================================================================================

[2/5] Scanning: 美的集团 (000333.SZ)
  >>> BUY SIGNAL: Type 1 Buy @ 77.85 (+1.73%)

[4/5] Scanning: 比亚迪 (002594.SZ)
  >>> SELL SIGNAL: Type 1 Sell @ 285.50 (+3.20%)

====================================================================================================
SIGNAL SUMMARY
====================================================================================================

[ BUY SIGNALS ] - Total: 2
Symbol       Name       Date         Type         SigPrice   CurPrice   Change  
--------------------------------------------------------------------------------
000333.SZ    美的集团   2026-02-20   Type 1 Buy      77.85    79.20   +1.73%
...
```

---

### 步骤3: 运行实时扫描（实际使用）

```bash
# 方式1: Python
python scan_signals_realtime.py

# 方式2: Windows批处理（双击）
run_scan.bat
```

**预期输出**:
```
====================================================================================================
Chan Theory Real-time Signal Scan - 2026-02-22 14:00:00
====================================================================================================
Stock universe: 67 stocks

[1/67] Scanning: 平安银行 (000001.SZ)
  [000001.SZ] Using 20y cached data
  No recent signals

[5/67] Scanning: 长安汽车 (000625.SZ)
  [000625.SZ] Using 20y cached data
  >>> BUY SIGNAL: Type 1 Buy @ 12.58 (+2.15%)

...

====================================================================================================
SIGNAL SUMMARY
====================================================================================================

[ BUY SIGNALS ] - Total: 3
...

[ SELL SIGNALS ] - Total: 2
...

Results saved to: results/realtime_scan/
  Timestamp: 20260222_140000
```

---

### 步骤4: 查看扫描结果

**结果文件位置**: `results/realtime_scan/`

```
results/realtime_scan/
├── buy_signals_20260222_140000.csv      # 买点详情（Excel可打开）
├── buy_signals_20260222_140000.json     # 买点详情（JSON格式）
├── sell_signals_20260222_140000.csv     # 卖点详情
├── sell_signals_20260222_140000.json    # 卖点详情
└── summary_20260222_140000.json         # 汇总数据
```

---

### 步骤5: 分析扫描历史（运行多次后）

```bash
python analyze_scan_history.py
```

**预期输出**:
```
Loading scan history...
Loaded 30 scan records

====================================================================================================
SCAN HISTORY ANALYSIS
====================================================================================================

[ BUY SIGNAL FREQUENCY ]
--------------------------------------------------------------------------------
Rank   Symbol       Count    Avg Price    Recent Signals
--------------------------------------------------------------------------------
1      000333.SZ    5        75.20        0220@77.85, 0219@76.50, 0218@74.20
2      601012.SS    4        25.80        0221@25.60, 0218@26.20
...

[ SUMMARY ]
--------------------------------------------------------------------------------
Total buy signals: 45
Unique stocks with buy signals: 12
Total sell signals: 38
Unique stocks with sell signals: 10

Chart saved: results/realtime_scan/history_analysis_20260222.png
```

---

## 📋 每日工作流程

### 交易日下午1:50
1. 运行实时扫描: `python scan_signals_realtime.py`
2. 查看控制台输出的信号汇总
3. 根据信号制定交易计划

### 交易日下午2:00-2:30
1. 根据买点信号，考虑建仓/加仓
2. 根据卖点信号，考虑减仓/清仓
3. 同时出现买卖信号的股票，观望或高抛低吸

### 收盘后
1. 查看保存的CSV文件，做详细分析
2. 更新交易日志
3. 准备第二天的交易计划

---

## ⚙️ 设置定时任务（Windows）

### 自动运行设置

1. **创建批处理文件**（已提供）
   - 文件: `run_scan.bat`
   - 功能: 一键运行扫描

2. **设置任务计划程序**
   
   按 `Win + R`，输入 `taskschd.msc` 打开任务计划程序
   
   创建基本任务:
   - **名称**: ChanTheorySignalScan
   - **触发器**: 每天 13:50（下午1点50）
   - **操作**: 启动程序
   - **程序**: `C:\Users\jiman\Documents\trae_projects\us_stock\run_scan.bat`

3. **测试运行**
   - 右键点击 `run_scan.bat`
   - 选择"以管理员身份运行"
   - 查看输出是否正常

---

## 🎯 信号解读指南

### 买点信号

**第一类买点 (Type 1 Buy)**
- 特征: 下跌结束，向上突破中枢
- 风险: 可能继续下跌
- 操作: 建仓或重仓
- 示例: `美的集团 @ 77.85`

**第二类买点 (Type 2 Buy)**
- 特征: 第一类买点后回调不创新低
- 风险: 可能转为震荡
- 操作: 加仓或买入
- 示例: `隆基绿能 @ 25.60`

### 卖点信号

**第一类卖点 (Type 1 Sell)**
- 特征: 上涨结束，向下跌破中枢
- 风险: 可能继续上涨
- 操作: 清仓或减仓
- 示例: `比亚迪 @ 285.50`

**第二类卖点 (Type 2 Sell)**
- 特征: 第一类卖点后反弹不创新高
- 风险: 可能转为震荡
- 操作: 减仓或观望
- 示例: `中国中免 @ 185.00`

### 特殊情况

**同时出现买卖信号**
- 含义: 股票处于震荡区间
- 策略: 高抛低吸或观望
- 示例: 隆基绿能同时出现Type 2 Buy和Type 1 Sell

---

## 📊 重要指标解释

| 字段 | 说明 | 示例 |
|------|------|------|
| Symbol | 股票代码 | 000333.SZ |
| Name | 股票名称 | 美的集团 |
| Signal Date | 信号日期 | 2026-02-20 |
| Signal Type | 信号类型 | Type 1 Buy |
| SigPrice | 信号价格 | 77.85 |
| CurPrice | 当前价格 | 79.20 |
| Change | 涨跌幅 | +1.73% |

**关键判断**:
- Change > 0: 信号后上涨（买点可能错过最佳时机）
- Change < 0: 信号后下跌（买点可能更划算/卖点可能过早）
- Change ≈ 0: 仍在信号价格附近，可考虑操作

---

## 🛠️ 故障排除

### 问题1: 扫描没有输出任何信号

**原因**: 
- 缓存数据过期（截止到2月12日）
- 当前不是交易日
- 最近5个交易日确实无信号

**解决**:
```bash
# 1. 检查数据日期
ls data_cache/*_20y_1d_forward.csv | head -5

# 2. 删除旧缓存，强制获取新数据（如需）
rm data_cache/000001.SZ_1y_1d_forward.csv

# 3. 重新运行
python scan_signals_realtime.py
```

### 问题2: 运行报错（编码错误）

**解决**: 已修复，如仍有问题，检查系统区域设置

### 问题3: 运行速度慢

**解决**: 减少股票池数量

编辑 `scan_signals_realtime.py`:
```python
STOCK_UNIVERSE = {
    # 只保留关注的股票
    '000001.SZ': '平安银行',
    '600519.SS': '贵州茅台',
    # 删除其他...
}
```

---

## 📈 进阶使用

### 自定义股票池

```python
# 只监控科技股
TECH_STOCKS = {
    '002230.SZ': '科大讯飞',
    '002475.SZ': '立讯精密',
    '300033.SZ': '同花顺',
    '300750.SZ': '宁德时代',
}

scanner = SignalScanner(stock_universe=TECH_STOCKS)
```

### 调整信号检测灵敏度

```python
# 检测近10个交易日的信号（更宽松）
for bp in chan.buy_points:
    if bp['index'] >= data.index[-10]:  # 默认是-5
        ...
```

### 添加邮件通知

```python
import smtplib

def send_email(subject, body):
    # 配置SMTP服务器
    server = smtplib.SMTP('smtp.gmail.com', 587)
    server.sendmail(from_addr, to_addr, msg)
```

---

## 📚 相关文档

| 文档 | 说明 |
|------|------|
| `README.md` | 项目主文档 |
| `PROJECT_INDEX.md` | 项目文件索引 |
| `REALTIME_SCAN_USAGE.md` | 实时扫描详细说明 |
| `WEEKLY_BOLL_STRATEGY.md` | 布林带策略文档 |

---

## ✅ 检查清单

- [ ] 运行回测验证策略有效性
- [ ] 运行演示脚本熟悉输出
- [ ] 运行实时扫描测试
- [ ] 设置定时任务
- [ ] 查看结果文件
- [ ] 分析历史扫描记录（运行多次后）

---

**有疑问？** 查看详细文档 `REALTIME_SCAN_USAGE.md` 或 `PROJECT_INDEX.md`
